# MapGuide RFC 14 - Cartographic Stylization Engine

This page contains an change request (RFC) for the MapGuide Open Source project. More MapGuide RFCs can be found on the [RFCs](https://trac.osgeo.org/mapguide/wiki/MapGuideRfcs) page.

## Status



| RFC Template Version  | 1.0                                        |
| --------------------- | ------------------------------------------ |
| Submission Date       | Feb 2, 2007                                |
| Last Modified         | Walt Welton-Lair Timestamp?                |
| Author                | Many                                       |
| RFC Status            | Adopted                                    |
| Implementation Status | Completed (except for symbol localization) |
| Proposed Milestone    | 1.2                                        |
| Assigned PSC guide(s) | Tom Fukushima                              |
| **Voting History**    | Feb 27, 2007                               |
| +1                    | Tom, Jason, Bruce, Andy, Paul, Bob, Haris  |
| +0                    |                                            |
| -0                    |                                            |
| -1                    |                                            |



## Overview

This document describes a proposal for adding a cartographic styling engine to MapGuide. The main goal is to be able to handle point, line, and fill styles as sophisticated as AutoCAD as well as being able to represent all symbols described in
本文档描述了向MapGuide添加制图样式引擎的建议。 主要目标是能够处理点图，直线和填充样式，这些样式与AutoCAD一样复杂，并且能够表示

[http://ngmdb.usgs.gov/fgdc_gds/geolsymstd/fgdc-geolsym-allnocharts.pdf](http://ngmdb.usgs.gov/fgdc_gds/geolsymstd/fgdc-geolsym-allnocharts.pdf)

We are aware that this is a high standard we want to live up to and it is currently beyond our ability to fully test against this standard. At this point though we still believe that we can create all symbols with the proposed solution represented by these two major requirements. Note: the FGDC standard goes beyond line styles, fill styles, and point styles – we are ignoring anything else in that document.
我们知道，这是我们要遵守的高标准，目前超出了我们完全测试该标准的能力。 在这一点上，尽管我们仍然相信我们可以使用由这两个主要要求表示的提议解决方案来创建所有符号。 注意：FGDC标准不仅限于线型，填充型和点型-我们将忽略该文档中的其他内容。

## Motivation

Most GIS applications are in need of very sophisticated symbolization. In many countries published maps must adhere to high standards that are often even written into law. This RFC introduces a high quality symbolization engine for MapGuide.
大多数GIS应用程序都需要非常复杂的符号化。 在许多国家/地区，已发布的地图必须遵守经常被写入法律的高标准。 该RFC为MapGuide引入了高质量的符号引擎。

The new engine will also support using point symbols as labels. This addresses a long standing MapGuide request for being able to create maps that use highway symbolization as part of labeling.
新引擎还将支持使用点符号作为标签。 这解决了长期存在的MapGuide要求，要求能够创建使用高速公路符号化作为标签一部分的地图。

## Proposed Solution 拟议的解决方案

The proposal is to create one engine that will satisfy the requirements of all three symbolizations (point, line, and area). This engine will use as input a new XML resource, parameters, and geometry, and will use the rendering interface of MapGuide to perform high quality stylization from those inputs. The resource format and the engine will ultimately be able to handle all three symbolization types.
建议是创建一种引擎，该引擎将满足所有三个符号（点，线和面）的要求。 该引擎将使用新的XML资源，参数和几何体作为输入，并将使用MapGuide的呈现接口从这些输入中执行高质量的样式化。 资源格式和引擎最终将能够处理所有三种符号化类型。

To implement all of this we will create a new type-style element for the MapGuide LayerDefinition schema. This type-style can reference the new symbolization resources.
为了实现所有这些，我们将为MapGuide LayerDefinition模式创建一个新的类型样式元素。 这种类型的样式可以引用新的符号资源。

Symbols themselves will be represented as a new resource type, and will be stored in the MapGuide resource repository. Groups of symbols can then be easily stored in folders in the repository to represent symbol libraries. The proposed design includes the ability to define both simple and compound symbols. A simple symbol consists of a collection of path, image, and text elements that define the graphics, and information on how the symbol is used in the context of points, lines, and areas. A compound symbol contains a collection of simple symbols, either inlined or using references to existing symbols.
符号本身将被表示为新的资源类型，并将被存储在MapGuide资源库中。 然后可以将符号组轻松存储在存储库中的文件夹中，以表示符号库。 拟议的设计包括定义简单符号和复合符号的能力。 一个简单的符号包括定义图形的路径，图像和文本元素的集合，以及有关在点，线和面的上下文中如何使用该符号的信息。 复合符号包含内联或使用对现有符号的引用的简单符号的集合。

The details on how the symbolization works are best gathered from the XML schema. Please refer to appendix A for the schema.
最好从XML模式中收集有关符号化工作方式的详细信息。 有关架构，请参阅附录A。

Here are some examples to make it more clear how the symbol engine will work.
下面是一些示例，以使符号引擎的工作方式更加清楚。

**Example 1:** interstate highway symbol label 州际公路符号标签

[![img](MapGuideRfc14\ex1.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex1.jpg)

This is a symbol containing an image (could also be paths) and a variable size text string.
这是一个包含图像（也可以是路径）和可变大小文本字符串的符号。

```html
<SimpleSymbolDefinition>
  <Name>US_Interstate</Name>
  <Graphics>
    <Image>
      <Reference> 										    <ResourceId>'Library://HighwaySymbols/ImageLibrary.SymbolDefinition'</ResourceId>
        <LibraryItemName>'InterstateImage'</LibraryItemName>
      </Reference>
      <SizeX>10.8</SizeX>
      <SizeY>11.2</SizeY>
      <PositionX>0</PositionX>
      <PositionY>0.8</PositionY>
    </Image>
    <Text>
      <Content>%INTERSTATE_NUMBER%</Content>
      <FontName>'Arial'</FontName>
      <Height>6</Height>
      <PositionX>0</PositionX>
      <PositionY>0</PositionY>
      <HorizontalAlignment>'Center'</HorizontalAlignment>
      <VerticalAlignment>'Halfline'</VerticalAlignment>
    </Text>
  </Graphics>
  <LineUsage>
    <AngleControl>'FromAngle'</AngleControl>
    <VertexControl>'OverlapNoWrap'</VertexControl>
    <Angle>0</Angle>
    <StartOffset>30</StartOffset>
    <EndOffset>30</EndOffset>
    <Repeat>100</Repeat>
  </LineUsage>
  <ParameterDefinition>
    <Parameter>
      <Identifier>INTERSTATE_NUMBER</Identifier>
      <DefaultValue>0</DefaultValue>
      <DisplayName>Interstate Number</DisplayName>
      <Description>The interstate number</Description>
      <DataType>Integer</DataType>
    </Parameter>
  </ParameterDefinition>
</SimpleSymbolDefinition>
```

The symbol graphics are defined such that the center of the text label is the symbol origin. The image is therefore shifted upwards slightly to compensate for this. The text string is also parametrized. Its value is obtained from an expression in the symbol instance. In this case the expression would be set to the interstate number attribute. One limitation of this symbol definition is that it doesn't resize if the number of characters in the text string changes. This limitation is removed in example 6 below.
定义符号图形，使文本标签的中心为符号原点。 因此，图像会稍微向上移动以补偿此情况。 文本字符串也已参数化。 它的值是从符号实例中的表达式获得的。 在这种情况下，表达式将设置为州际号码属性。 此符号定义的一个限制是，如果文本字符串中的字符数发生更改，则它不会调整大小。 在下面的示例6中删除了此限制。

**Example 2:** line style with simple dashing

[![img](MapGuideRfc14\ex2.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex2.jpg)

The repeating dash pattern is “long dash / dot / short dash / dot”. The long dash is 10 mm long and the short dash is 5 mm long. Each gap is 2.5 mm. The overall period of the dashing is 25 mm. The symbol definition XML would be:
重复的破折号为“长破折号/点/短破折号/点”。 长破折号是10毫米长，短破折号是5毫米长。 每个间隙为2.5毫米。 破折的总周期为25毫米。 符号定义XML为：

```
<SimpleSymbolDefinition>
  <Name>LongDash-Dot-ShortDash-Dot</Name>
  <Graphics>
    <Path>
      <Geometry>
        M  0.0,0 L 10.0,0
        M 12.5,0 L 12.5,0
        M 15.0,0 L 20.0,0
        M 22.5,0 L 22.5,0
      </Geometry>
      <LineColor>ff00000</LineColor>
    </Path>
  </Graphics>
  <LineUsage>
    <VertexControl>'OverlapWrap'</VertexControl>
    <Repeat>25</Repeat>
  </LineUsage>
  <ParameterDefinition/>
</SimpleSymbolDefinition>
```

In the path geometry all the formatting elements (line color, line cap, line join, …) are left out – they take on their default values. For the LineUsage the default vertex control is OverlapNoWrap, and here we set it to OverlapWrap. OverlapWrap means it’s ok to draw the symbol if it overlaps a vertex, but make it bend around the vertex. For simple line styles consisting of centerline dashing, OverlapWrap is the standard behavior we’re used to.
在路径几何中，所有格式设置元素（线颜色，线帽，线连接等）都被忽略了，它们采用默认值。 对于LineUsage，默认的顶点控件是OverlapNoWrap，在这里我们将其设置为OverlapWrap。 OverlapWrap表示，如果符号与顶点重叠，则可以绘制符号，但可以使其围绕顶点弯曲。 对于包含中心虚线的简单线条样式，OverlapWrap是我们习惯的标准行为。

**Example 3:** line style with a decoration and thickness
具有装饰和厚度的线条样式

[![img](C:\Users\NYJ\WorkSpace\zwatch_web\source\_posts\Project\Gis\MapGuideRfc\MapGuideRfc14\ex3.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex3.jpg)

The repeating pattern is just a cross. It repeats with period 5 mm.
重复的图案只是一个十字架。 重复周期为5毫米。

```
<SimpleSymbolDefinition>
  <Name>ThickRail</Name>
  <Description>This is a railroad symbol</Description>
  <Graphics>
    <Path>
      <Geometry>
        M 0.0, 0.0 L 5.0,0.0
        M 2.5,-2.5 L 2.5,2.5
      </Geometry>
      <LineWeight>%LINE_WEIGHT%</LineWeight>
      <LineCap>'Round'</LineCap>
      <LineJoin>'Round'</LineJoin>
    </Path>
  </Graphics>
  <LineUsage>
    <VertexControl>'OverlapWrap'</VertexControl>
    <Repeat>5</Repeat>
  </LineUsage>
  <ParameterDefinition>
    <Parameter>
      <Identifier>LINE_WEIGHT</Identifier>
      <DefaultValue>1.0</DefaultValue>
      <DisplayName>Line Weight</DisplayName>
      <DataType>Real</DataType>
    </Parameter>
  </ParameterDefinition>
</SimpleSymbolDefinition>
```

This time the line weight for the path has been parametrized. Its default value is 1 mm, as specified in the ParameterDefinition element, and this can be overridden at the symbol instance level. We’ve also changed the path’s line cap and line join styles to round.
这次已设置了路径的线宽。 如ParameterDefinition元素中所指定，其默认值为1 mm，可以在符号实例级别上覆盖它的默认值。 我们还将路径的线帽和线连接样式更改为圆形。

Note that when the line weight is modified the spacing between the vertical ticks does *not* change. The path geometry is fixed. If you want the symbol to get bigger / smaller to account for the line weight then this would be done using the symbol instance scales. For example, setting the scales to “1 + %LINE_WEIGHT% / 5” would ensure that there is always 5 mm of empty horizontal space between adjacent vertical ticks.
请注意，修改线宽后，垂直刻度之间的间隔不会*改变*。 路径几何是固定的。 如果要使符号变大或变小以占线宽，则可以使用符号实例比例来完成。 例如，将比例尺设置为“ 1 +％LINE_WEIGHT％/ 5”将确保相邻的垂直刻度之间始终有5毫米的水平空间。

**Example 4:** line style with start / end symbols
具有开始/结束符号的线条样式

[![img](https://trac.osgeo.org/mapguide/raw-attachment/wiki/MapGuideRfc14/ex4.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex4.jpg)

This line style includes text along the centerline, and start / end symbols. In order to store all three components of the line style together we need to make this a compound symbol definition.
此线型包括沿中心线的文字以及开始/结束符号。 为了将线型的所有三个组成部分存储在一起，我们需要使它成为一个复合符号定义。

```html
<CompoundSymbolDefinition>
  <Name>GasWithStartEndSymbols</Name>
  <SimpleSymbol>
    <SimpleSymbolDefinition>
      <Name>GasStyle</Name>
      <Graphics>
        <Path>
          <Geometry>M 0,0 H 5 M 15,0 H 5</Geometry>
          <LineWeight>1</LineWeight>
          <LineCap>'Round'</LineCap>
          <LineJoin>'Round'</LineJoin>
        </Path>
        <Text>
          <Content>'GAS'</Content>
          <FontName>'Arial'</FontName>
          <Height>3.5</Height>
          <PositionX>10</PositionX>
          <PositionY>0</PositionY>
          <HorizontalAlignment>'Center'</HorizontalAlignment>
          <VerticalAlignment>'Halfline'</VerticalAlignment>
        </Text>
      </Graphics>
      <LineUsage>
        <VertexControl>'OverlapWrap'</VertexControl>
        <Repeat>20</Repeat>
      </LineUsage>
      <ParameterDefinition/>
    </SimpleSymbolDefinition>
  </SimpleSymbol>
  <SimpleSymbol>
    <SimpleSymbolDefinition>
      <Name>BlueSquare</Name>
      <Graphics>
        <Path>
          <Geometry>M -0.5,-0.5 H 1, V 1, H -1, Z</Geometry>
          <FillColor>c00000ff</FillColor>
        </Path>
      </Graphics>
      <LineUsage>
        <VertexControl>'OverlapNoWrap'</VertexControl>
        <StartOffset>0</StartOffset>
        <Repeat>0</Repeat>
      </LineUsage>
      <ParameterDefinition/>
    </SimpleSymbolDefinition>
  </SimpleSymbol>
  <SimpleSymbol>
    <SimpleSymbolDefinition>
      <Name>RedTriangle</Name>
      <Graphics>
        <Path>
          <Geometry>M -0.5,-0.5 H 1, L 0,1, Z</Geometry>
          <FillColor>c0ff0000</FillColor>
        </Path>
      </Graphics>
      <LineUsage>
        <VertexControl>'OverlapNoWrap'</VertexControl>
        <EndOffset>0</EndOffset>
        <Repeat>0</Repeat>
      </LineUsage>
      <ParameterDefinition/>
    </SimpleSymbolDefinition>
  </SimpleSymbol>
</CompoundSymbolDefinition>
```

In this case the order of the symbols in the compound determines the draw order. Here, the start and end symbols are drawn on top of the dashing. For the start symbol the StartOffset and Repeat are set to 0. This ensures the symbol is only drawn once at the start of the feature. Likewise, for the end symbol we set the EndOffset and Repeat to 0. We also want OverlapNoWrap for the VertexControl. The symbol can overlap a vertex, but we simply want to “stamp” it – no bending around vertices.
在这种情况下，复合符号中符号的顺序决定了绘制顺序。 在这里，开始和结束符号绘制在虚线的顶部。 对于起始符号，将StartOffset和Repeat设置为0。这可确保在功能开始时仅绘制一次符号。 同样，对于结束符号，我们将EndOffset和Repeat设置为0。我们还希望对VertexControl使用OverlapNoWrap。 该符号可以与一个顶点重叠，但是我们只想对其“加盖戳”-不会在顶点周围弯曲。

One other note: the default AngleControl behavior is FromGeometry. This means the angle of the start / end symbol will be computed from the geometry, as shown here.
另一个注意事项：默认的AngleControl行为是FromGeometry。 这意味着将根据几何图形计算开始/结束符号的角度，如下所示。

[![img](MapGuideRfc14\ex4a.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex4a.jpg)

If you wanted the start / end symbol angles to be a fixed value you would change AngleControl to FromAngle and specify the Angle, e.g.
如果您希望开始/结束符号角度为固定值，则可以将AngleControl更改为FromAngle并指定角度，例如

```
    <SimpleSymbolDefinition>
      <Name>BlueSquare</Name>
      ...
      <LineUsage>
        <AngleControl>'FromAngle'</AngleControl>
        <VertexControl>'OverlapNoWrap'</VertexControl>
        <Angle>0</Angle>
        <StartOffset>0</Repeat>
        <Repeat>0</Repeat>
      </LineUsage>
      ...
    </SimpleSymbolDefinition>
```

[![img](https://trac.osgeo.org/mapguide/raw-attachment/wiki/MapGuideRfc14/ex4b.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex4b.jpg)

**Example 5:** line style with a special cross-tick offset requirement
**示例5：**具有特殊的交叉刻度偏移要求的线条样式

[![img](https://trac.osgeo.org/mapguide/raw-attachment/wiki/MapGuideRfc14/ex5.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex5.jpg)

This line style is one that the current MapGuide stylization code can’t handle. The problem is that the cross tick decoration needs to have a different start offset than the other decorations. Our new stylization schema handles this easily though. We have to create a compound symbol definition since we have two symbol components with different distributions.
这种线型是当前MapGuide样式化代码无法处理的。 问题在于，十字刻度装饰需要具有与其他装饰不同的起始偏移量。 不过，我们的新样式化架构可以轻松解决此问题。 因为我们有两个具有不同分布的符号组件，所以我们必须创建一个复合符号定义。

```
<CompoundSymbolDefinition>
  <Name>MTYP1500a</Name>
  <SimpleSymbol>
    <SimpleSymbolDefinition>
      <Name>UpperLowerDashing</Name>
      <Graphics>
        <Path>
          <Geometry>
            M 0,-2.5 h 8 m 2,0 h 8 m 2,0 h 2
            M 0,2.5 h 8 m 2,0 h 8 m 2,0 h 2
          </Geometry>
        </Path>
      </Graphics>
      <LineUsage>
        <VertexControl>'OverlapWrap'</VertexControl>
        <Repeat>24</Repeat>
      </LineUsage>
      <ParameterDefinition/>
    </SimpleSymbolDefinition>
  </SimpleSymbol>
  <SimpleSymbol>
    <SimpleSymbolDefinition>
      <Name>OffsetCrossTick</Name>
      <Graphics>
        <Path>
          <Geometry>M 0.0,-2.5 v 5</Geometry>
        </Path>
      </Graphics>
      <LineUsage>
        <VertexControl>'OverlapWrap'</VertexControl>
        <StartOffset>28</StartOffset>
        <Repeat>24</Repeat>
      </LineUsage>
      <ParameterDefinition/>
    </SimpleSymbolDefinition>
  </SimpleSymbol>
</CompoundSymbolDefinition>
```

The upper / lower dashing has zero start offset, whereas the cross tick has a 28 mm offset. This horizontally positions the first cross tick at the center of the first long dash in the second cycle of upper / lower dashing.
上/下虚线的起始偏移为零，而十字刻度的偏移为28 mm。 在上/下划线的第二个循环中，这会将第一个十字刻度水平放置在第一个长划线的中心。

**Example 6:** auto-resizing interstate highway symbol

The highway in example 1 was designed to display 1 or 2 digit interstate numbers. In the case of a 3 digit number you would end up with something like:
示例1中的高速公路被设计为显示1或2位州际号码。 对于3位数的数字，您将得到类似以下内容的结果：

[![img](https://trac.osgeo.org/mapguide/raw-attachment/wiki/MapGuideRfc14/ex6a.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex6a.jpg)

To fix this we can update the symbol to auto-resize based on the text string:
为了解决这个问题，我们可以根据文本字符串将符号更新为自动调整大小：

```html
<SimpleSymbolDefinition>
  <Name>US_Interstate</Name>
  <Graphics>
    <Image>
      <ResizeControl>'AdjustToResizeBox'</ResizeControl>
      <Reference>
        <ResourceId>'Library://HighwaySymbols/ImageLibrary.SymbolDefinition'</ResourceId>
        <LibraryItemName>'InterstateImage'</LibraryItemName>
      </Reference>
      <SizeX>10.8</SizeX>
      <SizeY>11.2</SizeY>
      <PositionX>0</PositionX>
      <PositionY>0.8</PositionY>
    </Image>
    <Text>
      <ResizeControl>'AddToResizeBox'</ResizeControl>
      <Content>%INTERSTATE_NUMBER%</Content>
      <FontName>'Arial'</FontName>
      <Height>6</Height>
      <PositionX>0</PositionX>
      <PositionY>0</PositionY>
      <HorizontalAlignment>'Center'</HorizontalAlignment>
      <VerticalAlignment>'Halfline'</VerticalAlignment>
    </Text>
  </Graphics>
  <ResizeBox>
    <SizeX>6</SizeX>
    <SizeY>5</SizeY>
    <PositionX>0</PositionX>
    <PositionY>0</PositionY>
    <GrowControl>'GrowInX'</GrowControl>
  </ResizeBox>
  <LineUsage>
    <AngleControl>'FromAngle'</AngleControl>
    <VertexControl>'OverlapNoWrap'</VertexControl>
    <Angle>0</Angle>
    <StartOffset>30</StartOffset>
    <EndOffset>30</EndOffset>
    <Repeat>100</Repeat>
  </LineUsage>
  <ParameterDefinition>
    <Parameter>
      <Identifier>INTERSTATE_NUMBER</Identifier>
      <DefaultValue>0</DefaultValue>
      <DisplayName>Interstate Number</DisplayName>
      <Description>The interstate number</Description>
      <DataType>Integer</DataType>
    </Parameter>
  </ParameterDefinition>
</SimpleSymbolDefinition>
```

All we've done is include a ResizeBox and specify the ResizeControl for each graphic element. The ResizeBox is positioned at the same location as the Text element, and has an initial size of 6 mm by 5 mm. This box fits nicely in the Image element - as long as the text does not extend outside of this box then no resizing is needed. The GrowControl setting for the resize box is GrowInX, which means the box is only allowed to grow horizontally.
我们要做的就是添加一个ResizeBox并为每个图形元素指定ResizeControl。 ResizeBox与Text元素位于同一位置，并且初始大小为6毫米乘5毫米。 此框非常适合Image元素-只要文本不超出此框，则无需调整大小。 调整大小框的GrowControl设置为GrowInX，这意味着该框仅允许水平增长。

The Text element's ResizeControl is set to AddToResizeBox. This means the graphical extent of the element is added to the resize box, and the box will grow, if necessary, to include that extent. In the case of 1 or 2 digit interstate numbers no growth occurs, but in the case of a 3 digit number the box will grow horizontally to fit the text.
Text元素的ResizeControl设置为AddToResizeBox。 这意味着将元素的图形范围添加到调整大小框，并且如果需要，该框将增大以包括该范围。 如果是1位或2位数字的州际号码，则不会增长，但如果是3位数字的状态，则框将水平增长以适合文本。

The Image element's ResizeControl is set to AdjustToResizeBox. This means the element will be resized and repositioned if the resize box grows in size. For example, if the resize box width grows by 10% then the element will be scaled horizontally by a factor of 1.1. The scaling is done about the center of the resize box.
Image元素的ResizeControl设置为AdjustToResizeBox。 这意味着如果调整大小框的大小增加，则将调整元素的大小并重新定位。 例如，如果调整大小框的宽度增加10％，则元素将水平缩放1.1倍。 缩放是围绕调整大小框的中心完成的。

Here's what the updated symbol looks like when displaying a 3 digit interstate number.
这是显示3位数州际号码时更新后的符号的外观。

[![img](https://trac.osgeo.org/mapguide/raw-attachment/wiki/MapGuideRfc14/ex6b.jpg)](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/ex6b.jpg)

## Theming and Localization of Symbols

符号的主题化和本地化

Most properties in the SymbolDefinition can be parametrized. This means that an expression can be provided that references attributes in the layer feature source for which the SymbolDefinition is used. An example of a parametrized value would be:
可以对SymbolDefinition中的大多数属性进行参数化。 这意味着可以提供一个表达式，该表达式引用使用SymbolDefinition的图层要素源中的属性。 参数化值的示例为：

```html
<LineWeight>%1%</LineWeight>
```

This means that the parameter named 1 can be set to an expression in the LayerDefinition, based on style choices made by the map author. The SymbolDefinition must also declare this parameter in its ParameterDefinition element. Here it describes what that parameter does and also provides a default value for the parameter. Here is a sample SymbolDefinition with this ParameterDefinition element:
这意味着可以根据地图作者的样式选择将名为1的参数设置为LayerDefinition中的表达式。 SymbolDefinition还必须在其ParameterDefinition元素中声明此参数。 在这里，它描述了该参数的作用，还提供了该参数的默认值。 这是带有此ParameterDefinition元素的示例SymbolDefinition：

```html
<SimpleSymbolDefinition>
  <Name>ThickRail</Name>
  <Description>This is a railroad symbol</Description>
  <Graphics>
    <Path>
      <Geometry>
        M 0.0, 0.0 L 5.0,0.0
        M 2.5,-2.5 L 2.5,2.5
      </Geometry>
      <LineWeight>%LINE_WEIGHT%</LineWeight>
      <LineCap>'Round'</LineCap>
      <LineJoin>'Round'</LineJoin>
    </Path>
  </Graphics>
  <LineUsage>
    <VertexControl>'OverlapWrap'</VertexControl>
    <Repeat>5</Repeat>
  </LineUsage>
  <ParameterDefinition>
    <Parameter>
      <Identifier>LINE_WEIGHT</Identifier>
      <DefaultValue>1.0</DefaultValue>
      <DisplayName>Line Weight</DisplayName>
      <Description>The line weight for the symbol</Description>
      <DataType>Real</DataType>
    </Parameter>
  </ParameterDefinition>
</SimpleSymbolDefinition>
```

For translation of this symbol into other languages, our solution is to create a translated parameter section and attach that to the SymbolDefinition resource in the MapGuide repository as Resource Data. The name of the attached resource will contain the locale of the translation. For example, if the original symbol is called Symbol.xml, the German translated section would be called Symbol.xml.de. Here is what it would look like:
为了将此符号翻译成其他语言，我们的解决方案是创建一个翻译后的参数部分，并将其作为“资源数据”附加到MapGuide存储库中的SymbolDefinition资源。 附加资源的名称将包含翻译的语言环境。 例如，如果原始符号称为Symbol.xml，则德语翻译部分将称为Symbol.xml.de。 看起来像这样：

```html
<SimpleSymbolDefinition>
  <Name>DickeEisenBahnSchiene</Name>
  <Description>Das ist ein Eisenbahnschienen Symbol</Description>
  <ParameterDefinition>
    <Parameter>
      <Identifier>LINE_WEIGHT</Identifier>
      <DefaultValue>1.0</DefaultValue>
      <DisplayName>Linien Dicke<DisplayName>
      <Description>Das ist nur ein Beispiel.</Description>
      <DataType>Real</DataType>
    </Parameter>
  </ParameterDefinition>
</SimpleSymbolDefinition>
```

## Implications 含义

The new symbol definitions will have an impact on the LayerDefinition XML schema. To preserve backwards compatibility, we propose to add a new CompositeTypeStyle element that will be the only LDF element that references new symbol definitions. The CompositeTypeStyle inherits FeatureTypeStyle alongside Area, Line and PointTypeStyle. Layers that have a CompositeTypeStyle will use a new code path for stylization based on the new SymbolDefinitions. Stylization of layers that have one of the old FeatureTypeStyles will not change. One will therefore be able to mix the two kinds of layers within the same map.
新的符号定义将对LayerDefinition XML模式产生影响。 为了保持向后兼容性，我们建议添加一个新的CompositeTypeStyle元素，它将是唯一引用新符号定义的LDF元素。 CompositeTypeStyle继承Area，Line和PointTypeStyle以及FeatureTypeStyle。 具有CompositeTypeStyle的图层将基于新的SymbolDefinitions使用新的代码路径进行样式化。 具有旧FeatureTypeStyles之一的图层的样式不会更改。 因此，一个人将能够在同一地图中混合两种图层。

Just like the other FeatureTypeStyles, the CompositeTypeStyle will hold on to a symbolization object (CompositeSymbolization) which defines the way features draw. The CompositeSymbolization will reference one or more SymbolDefinitions and also optionally define theming expressions for properties of the SymbolDefinition which are marked as parametrized. Those allow for the symbol definition to take up styles based on attributes of the specific feature class that the CompositeSymbolization is associated with.
就像其他FeatureTypeStyles一样，CompositeTypeStyle将保留在符号化对象（CompositeSymbolization）上，该对象定义要素绘制的方式。 CompositeSymbolization将引用一个或多个SymbolDefinition，并且还可以选择为SymbolDefinition的属性定义主题表达式，这些表达式被标记为参数化的。 这些允许符号定义根据与CompositeSymbolization关联的特定要素类的属性采用样式。

See Appendix A for a link to the schema for the proposed LayerDefinition additions.
有关所建议的LayerDefinition添加的指向架构的链接，请参见附录A。

## Test Plan

Unit tests will be written to verify the new cartographic styling engine. In addition we will also create a sample symbol library to use for testing.
将编写单元测试以验证新的制图样式引擎。 此外，我们还将创建一个示例符号库以用于测试。

## Funding/Resources?

Autodesk will provide resources to implement the core symbolization engine and detailed implementation for point symbols and label symbols. If time allows we will also implement some portion of the line symbolization. In the future we plan to finish the symbolization engine to also include area symbolization. Later stages may include some resourcing help from DM Solutions. Exact timing for the line and area symbolizations has yet to be determined, but we would like to complete it for the 1.3 release in the fall.
Autodesk将提供资源来实现核心符号引擎以及点符号和标签符号的详细实现。 如果时间允许，我们还将实现线符号化的某些部分。 将来，我们计划完成符号引擎，以包括区域符号。 后续阶段可能包括来自DM Solutions的一些资源帮助。 线条和区域符号的确切时间尚未确定，但我们希望在秋天的1.3版本中完成。

Update: stable versions of line and area symbolization have been available as of MGOS 2.0.1.
更新：自MGOS 2.0.1起，线和面符号的稳定版本已可用。

## Addendum, March 21, 2007

The following schema changes have been approved and made:
已批准并进行以下架构更改：

- removed invalid enumerations from  从中删除了无效的枚举SymbolInstance::CheckExclusionRegion element
  - it should be a plain xs:string

- changed SymbolInstance::SizeContext to be a SizeContextType
  将SymbolInstance :: SizeContext更改为SizeContextType
- this is for consistency
  
- made LineUsage::VertexAngleLimit an xs:string type
  - the type was missing in the schema

- made SymbolInstance::DrawLast an xs:string type
  - the type was missing in the schema 模式中缺少该类型

- changed all enumerated type properties to plain strings so they support expressions 将所有枚举类型属性更改为纯字符串，以便它们支持表达式
  - PointUsage::AngleControl
  - LineUsage::AngleControl
  - LineUsage::UnitsControl
  - LineUsage::VertexControl
  - AreaUsage::OriginControl
  - AreaUsage::AngleControl
  - AreaUsage::ClippingControl
  - Path::LineCap
  - Path::LineJoin
  - GraphicBaseType::ResizeControl
  - ResizeBox::GrowControl

- added a VertexJoin property on LineUsage
  - all graphic elements in the simple symbol use this value to determine their wrapping behavior at vertices
  简单符号中的所有图形元素都使用此值来确定其在顶点处的环绕行为
  
- renamed Parameter::ValueList to AllowedValues

- renamed SimpleSymbol::SimpleSymbolReference to SymbolReference
  - it's already clear enough that this is a SimpleSymbolReference because this is part of SimpleSymbol

- switched order of elements in AreaUsage
  - switched AngleControl and OriginControl
  - put Angle before OriginX and OriginY
  - makes AreaUsage more consistent with LineUsage and PointUsage

- changed Graphics collection to allow 0 to unbounded elements
  - currently it requires at least one element
  - users want to save their symbols while editing them
  - they may temporarily not contain any graphic elements

- same change for the CompoundSymbolDefinition::SimpleSymbol collection
  - allow 0 to unbounded symbols

- same change for the CompositeSymbolization::SymbolInstance collection
  - allow 0 to unbounded symbol instances

- reworked SymbolDefinition element
  - created separate SimpleSymbolDefinition and CompoundSymbolDefinition elements which are of the corresponding types
  - updated SymbolInstance to have either a SymbolReference, SimpleSymbolDefinition, or CompoundSymbolDefinition
  - deleted SymbolDefinition and SymbolDefinitionType

- moved CompositeSymbolization::ParameterOverrides into SymbolInstance
  - this lets someone use the same SymbolDefinition multiple times in a symbolization, but specify different overrides for each instance

- documented the default value for all optional elements

- for properties supporting expressions that must evaluate to certain string values, documented what those values are

## Addendum, March 23, 2007

The following additional schema changes have been made:

- added a HeightScalable property on Text
  - if set to false then any scale defined on the symbol instance is not applied to the font height

- added a SizeScalable property on Image
  - if set to false then any scale defined on the symbol instance is not applied to the image size

## Addendum, April 1, 2007

Updated schemas per ticket [#21](https://trac.osgeo.org/mapguide/ticket/21) (Change new symbolization SymbolReference elements to ResourceId for indexing).

## Addendum, April 3, 2007

Updated SymbolDefinition schema per ticket [#27](https://trac.osgeo.org/mapguide/ticket/27) (Schema does not allow setting resource ID for referenced content in Image graphic element).

## Addendum, April 12, 2007

Renamed the 'NoOverlap' VertexControl option to 'OverlapNone'.

## Addendum, April 19, 2007

Updated schemas per ticket [#46](https://trac.osgeo.org/mapguide/ticket/46) (Finish documenting symbolization schema).

## Addendum, April 24, 2007

Updated schemas per ticket [#79](https://trac.osgeo.org/mapguide/ticket/79) (Symbolization schema cleanup).

Updated schemas per ticket [#74](https://trac.osgeo.org/mapguide/ticket/74) (Add ExtendedData tags to symbolization schema).

## Addendum, May 1, 2007

Updated SymbolDefinition schema per ticket [#90](https://trac.osgeo.org/mapguide/ticket/90) (Rename Text.String element to Text.Content).

## Addendum, May 3, 2007

Updated schemas per ticket [#96](https://trac.osgeo.org/mapguide/ticket/96) (Make version attribute fixed for new layer and symbol definition schema).

## Addendum, May 15, 2007

Updated schemas per ticket [#122](https://trac.osgeo.org/mapguide/ticket/122) (Symbolization: some more minor schema changes).

## Appendix A

Link to the symbolization schema:

- [http://svn.osgeo.org/mapguide/trunk/MgDev/Common/Schema/SymbolDefinition-1.0.0.xsd](http://svn.osgeo.org/mapguide/trunk/MgDev/Common/Schema/SymbolDefinition-1.0.0.xsd)

Link to the updated MapGuide LayerDefinition schema:

- [http://svn.osgeo.org/mapguide/trunk/MgDev/Common/Schema/LayerDefinition-1.1.0.xsd](http://svn.osgeo.org/mapguide/trunk/MgDev/Common/Schema/LayerDefinition-1.1.0.xsd)

Link to autogenerated html documentation for the schemas (including only the relevant subset for LayerDefinition):

- [Symbolization.zip](https://trac.osgeo.org/mapguide/attachment/wiki/MapGuideRfc14/Symbolization.zip)[](https://trac.osgeo.org/mapguide/raw-attachment/wiki/MapGuideRfc14/Symbolization.zip)