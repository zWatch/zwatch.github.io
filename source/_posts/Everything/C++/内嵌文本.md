from https://www.zhihu.com/question/431645051/answer/1612612446

作者：黄兢成
链接：https://www.zhihu.com/question/431645051/answer/1594722543
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



这个问题我研究过。我的结论是没有完美方法，只有折衷方法，需要稍微修改原始文本。**折衷方法**比如原始 `test.glsl` 内容为

```glsl
vec4 mainImage(vec4 fragColor, vec2 fragCoord ) 
{    
	// Output to screen    
	fragColor = vec4(1.0, 0.0, 0.0, 1.0);    
	return fragColor; 
}
```

稍微修改，将文本变成 raw string，注意第一行和最后一行

```c++
R"(
vec4 mainImage(vec4 fragColor, vec2 fragCoord ) 
{    
	// Output to screen    
	fragColor = vec4(1.0, 0.0, 0.0, 1.0);
    return fragColor; 
} 
)"
```

之后就可以在 C++ 源码中直接 `#include`

```c++
const char *s_shadertoy = #include "test.glsl" ; 
```

`s_shadertoy` 存放的就是原来的文本内容，只是前后各多了一个空行。在实际工程中，需要这样 include 的文本很多都是 `json`、`xml` OpenGL Shader 等，多了空行没有所谓。**变种**假如不想额外多空行，可以这样写。`// test.glsl R"( vec4 mainImage(vec4 fragColor, vec2 fragCoord ) {    // Output to screen    fragColor = vec4(1.0, 0.0, 0.0, 1.0);    return fragColor; })" // main.cpp const char *s_shadertoy = (char*) #include "test.glsl" + 1;`另外也可以在原始文本中前后添加一点东西，比如可写成`const char *s_shadertoy = R"( varying vec2        vTexCoord; uniform vec3        iResolution;    // viewport resolution (in pixels) uniform float       iTime;          // shader playback time (in seconds) uniform sampler2D   iChannel0; uniform sampler2D   iChannel1; uniform sampler2D   iChannel2; uniform sampler2D   iChannel3; #define texture     texture2D )" #include "test.glsl"  // 文本插入字符串中间 R"( void main() {    vec4 fragColor = vec4(0.0, 0.0, 0.0, 1.0);    vec2 fragCoord = vec2(vTexCoord.x, 1.0 - vTexCoord.y) * iResolution.xy;    gl_FragColor = mainImage(fragColor, fragCoord); } )"; `自然也可以 include 多个文本文件，将其连起来，比如`const char *s_shadertoy = #include "test.glsl" #include "test.glsl" ; `**评价**这个小技巧有实际用途，并非仅是语法游戏。比如 OpenGL 程序需要嵌入某段 shader 代码，某些程序也经常嵌入 json 字符串作为默认配置。假如这些 shader 或者 json 字符串很长，可以将其分离到 `test.glsl`、`default_config.json` 等独立文件，再 include 进来。使用编辑器打开这些 glsl 或 json 文件，虽然原始文本稍微修改过，也可保留语法高亮，编辑阅读就相对容易。而假如将字符串直接嵌入在 C++ 源码中，就失去原始文本的语法高亮了。那为什么不将这些文件单独出去，用 IO 操作读进来呢？一方面是嵌入字符串是在编译期做的，不需要 IO, 速度更快。另外更重要的是，将字符串嵌入到代码中，编译后字符串就嵌入到目标文件中，永远不会丢失。比如将代码编译成 .a，就只有单独的 .a，别人链接 .a 就可以使用了。不然 .a 库带有额外的 xml 文件，这个 .a 库的用户就需要将 xml 文件的路径额外传进来，并且让用户保证 xml 文件一定存在。这样库就更难以使用和分发了。

[编辑于 11-25](http://www.zhihu.com/question/431645051/answer/1594722543)