# Implement navigation between two pages

- 2020/09/24
- ![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNMsAcAAQUAoVnxsV8AAAAASUVORK5CYII=)

Learn how to use a frame and pages to enable basic peer-to-peer navigation in your app.
了解如何使用框架和页面在应用程序中启用基本的对等导航。

> **Important APIs 重要的APIs**: [**Windows.UI.Xaml.Controls.Frame**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Frame) class, [**Windows.UI.Xaml.Controls.Page**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Page) class, [**Windows.UI.Xaml.Navigation**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Navigation) namespace

![对等导航](https://docs.microsoft.com/zh-cn/windows/uwp/design/basics/images/peertopeer.png)

## 1. Create a blank app

1. On the Microsoft Visual Studio menu, choose **File** > **New Project**.
   在Microsoft Visual Studio菜单上，选择**文件**>**新建项目**。
2. In the left pane of the **New Project** dialog box, choose the **Visual C#** > **Windows** > **Universal** or the **Visual C++** > **Windows** > **Universal** node.
   在**新建项目**对话框的左窗格中，选择**Visual C＃**>  **Windows** > **通用** 或  **Visual C ++** > **Windows ** > **通用** 节点。
3. In the center pane, choose **Blank App**.
   在中央窗格中，选择**空白应用程序**。
4. In the **Name** box, enter **NavApp1**, and then choose the **OK** button. The solution is created, and the project files appear in **Solution Explorer**.
   在 **名称** 框中，输入 **NavApp1** ，然后选择 **确定** 按钮。 解决方案已创建，项目文件显示在 **Solution Explorer** 中。
5. To run the program, choose **Debug** > **Start Debugging** from the menu, or press F5. A blank page is displayed.
要运行该程序，请从菜单中选择 **Debug ** > **Start Debugging**，或按F5。 显示空白页。
6. To stop debugging and return to Visual Studio, exit the app, or click **Stop Debugging** from the menu.
要停止调试并返回Visual Studio，请退出该应用程序，或从菜单中单击 **停止调试** 。

## 2. Add basic pages

Next, add two pages to the project.
接下来，将两个页面添加到项目中。

1. In **Solution Explorer**, right-click the **BlankApp** project node to open the shortcut menu.
   在 **Solution Explorer** 中，右键单击 **BlankApp** 项目节点以打开快捷菜单。
2. Choose **Add** > **New Item** from the shortcut menu.
   从快捷菜单中选择 **添加** > **新建项目**。
3. In the **Add New Item** dialog box, choose **Blank Page** in the middle pane.
   在 **添加新项** 对话框中，在中间窗格中选择 **空白页** 。
4. In the **Name** box, enter **Page1** (or **Page2**) and press the **Add** button.
   在 **名称** 框中，输入 **第1页** （或 **第2页**），然后按 **添加** 按钮。
5. Repeat steps 1-4 to add the second page.
   重复步骤1-4以添加第二页。

Now, these files should be listed as part of your NavApp1 project.

| C#                       | C++                                    |
| ------------------------ | -------------------------------------- |
| Page1.xaml Page1.xaml.cs | Page1.xaml Page1.xaml.cpp Page1.xaml.h |
| Page2.xaml Page2.xaml.cs | Page2.xaml Page2.xaml.cpp Page2.xaml.h |

In Page1.xaml, add the following content:
在Page1.xaml中，添加以下内容：

- A [**TextBlock**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBlock) element named `pageTitle` as a child element of the root [**Grid**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Grid). Change the [**Text**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.textblock.text) property to `Page 1`.
  一个名为`pageTitle`的[TextBlock](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBlock)元素作为根[Grid](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Grid)的子元素
    。 将[Text](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.textblock.text)属性更改为`Page 1'。

XAML复制

```xaml
<TextBlock x:Name="pageTitle" Text="Page 1" />
```

- A [**HyperlinkButton**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.HyperlinkButton) element as a child element of the root [**Grid**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Grid) and after the `pageTitle` [**TextBlock**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBlock) element.
  一个HyperlinkButton元素，它是根Grid的子元素，在`pageTitle` TextBlock元素之后。

XAML复制

```xaml
<HyperlinkButton Content="Click to go to page 2"
                 Click="HyperlinkButton_Click"
                 HorizontalAlignment="Center"/>
```

In the Page1.xaml code-behind file, add the following code to handle the `Click` event of the [**HyperlinkButton**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.HyperlinkButton) you added to navigate to Page2.xaml.

C++/WinRT复制

```cppwinrt
void Page1::HyperlinkButton_Click(Windows::Foundation::IInspectable const& sender, Windows::UI::Xaml::RoutedEventArgs const& args)
{
    Frame().Navigate(winrt::xaml_typename<NavApp1::Page2>());
}
```

In Page2.xaml, add the following content:

- A [**TextBlock**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBlock) element named `pageTitle` as a child element of the root [**Grid**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Grid). Change the value of the [**Text**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.textblock.text) property to `Page 2`.

XAML复制

```xaml
<TextBlock x:Name="pageTitle" Text="Page 2" />
```

- A [**HyperlinkButton**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.HyperlinkButton) element as a child element of the root [**Grid**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Grid) and after the `pageTitle` [**TextBlock**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBlock) element.

XAML复制

```xaml
<HyperlinkButton Content="Click to go to page 1" 
                 Click="HyperlinkButton_Click"
                 HorizontalAlignment="Center"/>
```

In the Page2.xaml code-behind file, add the following code to handle the `Click` event of the [**HyperlinkButton**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.HyperlinkButton) to navigate to Page1.xaml.

C++/WinRT复制

```cppwinrt
void Page2::HyperlinkButton_Click(Windows::Foundation::IInspectable const& sender, Windows::UI::Xaml::RoutedEventArgs const& args)
{
    Frame().Navigate(winrt::xaml_typename<NavApp1::Page1>());
}
```

 备注

For C++ projects, you must add a `#include` directive in the header file of each page that references another page. For the inter-page navigation example presented here, page1.xaml.h file contains `#include "Page2.xaml.h"`, in turn, page2.xaml.h contains `#include "Page1.xaml.h"`.

Now that we've prepared the pages, we need to make Page1.xaml display when the app starts.

Open the App.xaml code-behind file and change the `OnLaunched` handler.

Here, we specify `Page1` in the call to [**Frame.Navigate**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.navigate) instead of `MainPage`.

C++/WinRT复制

```cppwinrt
void App::OnLaunched(LaunchActivatedEventArgs const& e)
{
    Frame rootFrame{ nullptr };
    auto content = Window::Current().Content();
    if (content)
    {
        rootFrame = content.try_as<Frame>();
    }

    // Do not repeat app initialization when the Window already has content,
    // just ensure that the window is active
    if (rootFrame == nullptr)
    {
        // Create a Frame to act as the navigation context and associate it with
        // a SuspensionManager key
        rootFrame = Frame();

        rootFrame.NavigationFailed({ this, &App::OnNavigationFailed });

        if (e.PreviousExecutionState() == ApplicationExecutionState::Terminated)
        {
            // Restore the saved session state only when appropriate, scheduling the
            // final launch steps after the restore is complete
        }

        if (e.PrelaunchActivated() == false)
        {
            if (rootFrame.Content() == nullptr)
            {
                // When the navigation stack isn't restored navigate to the first page,
                // configuring the new page by passing required information as a navigation
                // parameter
                rootFrame.Navigate(xaml_typename<NavApp1::Page1>(), box_value(e.Arguments()));
            }
            // Place the frame in the current Window
            Window::Current().Content(rootFrame);
            // Ensure the current window is active
            Window::Current().Activate();
        }
    }
    else
    {
        if (e.PrelaunchActivated() == false)
        {
            if (rootFrame.Content() == nullptr)
            {
                // When the navigation stack isn't restored navigate to the first page,
                // configuring the new page by passing required information as a navigation
                // parameter
                rootFrame.Navigate(xaml_typename<NavApp1::Page1>(), box_value(e.Arguments()));
            }
            // Ensure the current window is active
            Window::Current().Activate();
        }
    }
}
```

 备注

The code here uses the return value of [**Navigate**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.navigate) to throw an app exception if the navigation to the app's initial window frame fails. When **Navigate** returns **true**, the navigation happens.

Now, build and run the app. Click the link that says "Click to go to page 2". The second page that says "Page 2" at the top should be loaded and displayed in the frame.

### About the Frame and Page classes

Before we add more functionality to our app, let's look at how the pages we added provide navigation within our app.

First, a [**Frame**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Frame) called `rootFrame` is created for the app in the `App.OnLaunched` method in the App.xaml code-behind file. The **Frame** class supports various navigation methods such as [**Navigate**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.navigate), [**GoBack**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.goback), and [**GoForward**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.goforward), and properties such as [**BackStack**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.backstack), [**ForwardStack**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.forwardstack), and [**BackStackDepth**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.backstackdepth).  The [**Navigate**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.navigate) method is used to display content in this **Frame**. By default, this method loads MainPage.xaml. In our example, `Page1` is passed to the **Navigate** method, so the method loads `Page1` in the **Frame**.

`Page1` is a subclass of the [**Page**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.Page) class. The **Page** class has a read-only **Frame** property that gets the **Frame** containing the **Page**. When the **Click** event handler of the **HyperlinkButton** in `Page1` calls `this.Frame.Navigate(typeof(Page2))`, the **Frame** displays the content of Page2.xaml.

Finally, whenever a page is loaded into the frame, that page is added as a [**PageStackEntry**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Navigation.PageStackEntry) to the [**BackStack**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.backstack) or [**ForwardStack**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.forwardstack) of the [**Frame**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.page.frame), allowing for [history and backwards navigation](https://docs.microsoft.com/zh-cn/windows/uwp/design/basics/navigation-history-and-backwards-navigation).

## 3. Pass information between pages

Our app navigates between two pages, but it really doesn't do anything interesting yet. Often, when an app has multiple pages, the pages need to share information. Let's pass some information from the first page to the second page.

In Page1.xaml, replace the **HyperlinkButton** you added earlier with the following [**StackPanel**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.StackPanel).

Here, we add a [**TextBlock**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBlock) label and a [**TextBox**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBox) `name` for entering a text string.

XAML复制

```xaml
<StackPanel>
    <TextBlock HorizontalAlignment="Center" Text="Enter your name"/>
    <TextBox HorizontalAlignment="Center" Width="200" Name="name"/>
    <HyperlinkButton Content="Click to go to page 2" 
                     Click="HyperlinkButton_Click"
                     HorizontalAlignment="Center"/>
</StackPanel>
```

In the `HyperlinkButton_Click` event handler of the Page1.xaml code-behind file, add a parameter referencing the `Text` property of the `name` **TextBox** to the `Navigate` method.

C++/WinRT复制

```cppwinrt
void Page1::HyperlinkButton_Click(Windows::Foundation::IInspectable const& sender, Windows::UI::Xaml::RoutedEventArgs const& args)
{
    Frame().Navigate(winrt::xaml_typename<NavApp1::Page2>(), winrt::box_value(name().Text()));
}
```

In Page2.xaml, replace the **HyperlinkButton** you added earlier with the following **StackPanel**.

Here, we add a [**TextBlock**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Controls.TextBlock) for displaying the text string passed from Page1.

XAML复制

```xaml
<StackPanel>
    <TextBlock HorizontalAlignment="Center" Name="greeting"/>
    <HyperlinkButton Content="Click to go to page 1" 
                     Click="HyperlinkButton_Click"
                     HorizontalAlignment="Center"/>
</StackPanel>
```

In the Page2.xaml code-behind file, add the following to override the `OnNavigatedTo` method:

C++/WinRT复制

```cppwinrt
void Page2::OnNavigatedTo(Windows::UI::Xaml::Navigation::NavigationEventArgs const& e)
{
    auto propertyValue{ e.Parameter().as<Windows::Foundation::IPropertyValue>() };
    if (propertyValue.Type() == Windows::Foundation::PropertyType::String)
    {
        greeting().Text(L"Hi, " + winrt::unbox_value<winrt::hstring>(e.Parameter()));
    }
    else
    {
        greeting().Text(L"Hi!");
    }
    __super::OnNavigatedTo(e);
}
```

Run the app, type your name in the text box, and then click the link that says **Click to go to page 2**.

When the **Click** event of the **HyperlinkButton** in `Page1` calls `this.Frame.Navigate(typeof(Page2), name.Text)`, the `name.Text` property is passed to `Page2`, and the value from the event data is used for the message displayed on the page.

## 4. Cache a page

Page content and state is not cached by default, so if you'd like to cache information, you must enable it in each page of your app.

In our basic peer-to-peer example, there is no back button (we demonstrate back navigation in [backwards navigation](https://docs.microsoft.com/zh-cn/windows/uwp/design/basics/navigation-history-and-backwards-navigation)), but if you did click a back button on `Page2`, the **TextBox** (and any other field) on `Page1` would be set to its default state. One way to work around this is to use the [**NavigationCacheMode**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.page.navigationcachemode) property to specify that a page be added to the frame's page cache.

In the constructor of `Page1`, you can set **NavigationCacheMode** to **Enabled** to retains all content and state values for the page until the page cache for the frame is exceeded. Set [**NavigationCacheMode**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.page.navigationcachemode) to [**Required**](https://docs.microsoft.com/zh-cn/uwp/api/Windows.UI.Xaml.Navigation.NavigationCacheMode) if you want to ignore [**CacheSize**](https://docs.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.frame.cachesize) limits, which specify the number of pages in the navigation history that can be cached for the frame. However, keep in mind that cache size limits might be crucial, depending on the memory limits of a device.

C++/WinRT复制

```cppwinrt
Page1::Page1()
{
    InitializeComponent();
    NavigationCacheMode(Windows::UI::Xaml::Navigation::NavigationCacheMode::Enabled);
}
```

## Related articles

- [Navigation design basics for Windows apps](https://docs.microsoft.com/zh-cn/windows/uwp/design/basics/navigation-basics)
- [Pivot](https://docs.microsoft.com/zh-cn/windows/uwp/design/controls-and-patterns/pivot)
- [Navigation view](https://docs.microsoft.com/zh-cn/windows/uwp/design/controls-and-patterns/navigationview)